<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–©–æ–¥–µ–Ω–Ω–∏–π –∑–≤—ñ—Ç</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 10px;
            color: var(--tg-theme-text-color);
        }

        .date {
            color: var(--tg-theme-hint-color, #999);
            margin-bottom: 20px;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--tg-theme-text-color);
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--tg-theme-hint-color, #ddd);
            border-radius: 8px;
            font-size: 16px;
            background: var(--tg-theme-bg-color, #fff);
            color: var(--tg-theme-text-color, #000);
            font-family: inherit;
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--tg-theme-button-color, #3390ec);
        }

        .task-list {
            margin-top: 10px;
        }

        .task-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .task-item input {
            flex: 1;
        }

        .btn-remove {
            padding: 12px 16px;
            background: #ff3b30;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-add {
            padding: 10px 16px;
            background: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #fff);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }

        .error {
            color: #ff3b30;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        .success-message {
            background: #34c759;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìù –©–æ–¥–µ–Ω–Ω–∏–π –∑–≤—ñ—Ç</h1>
        <div class="date" id="currentDate"></div>

        <div class="success-message" id="successMessage">
            ‚úÖ –ó–≤—ñ—Ç —É—Å–ø—ñ—à–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ!
        </div>

        <form id="reportForm">
            <div class="form-group">
                <label for="tasks">–í–∏–∫–æ–Ω–∞–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è *</label>
                <div class="task-list" id="taskList">
                    <div class="task-item">
                        <input type="text" placeholder="–û–ø–∏—à—ñ—Ç—å –∑–∞–≤–¥–∞–Ω–Ω—è..." required>
                        <button type="button" class="btn-remove" onclick="removeTask(this)">‚úï</button>
                    </div>
                </div>
                <button type="button" class="btn-add" onclick="addTask()">+ –î–æ–¥–∞—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è</button>
                <div class="error" id="tasksError">–î–æ–¥–∞–π—Ç–µ —Ö–æ—á–∞ –± –æ–¥–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è</div>
            </div>

            <div class="form-group">
                <label for="hours">–í–∏—Ç—Ä–∞—á–µ–Ω–æ –≥–æ–¥–∏–Ω *</label>
                <input type="number" id="hours" min="0" max="24" step="0.5" placeholder="8" required>
                <div class="error" id="hoursError">–í–∫–∞–∂—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≥–æ–¥–∏–Ω</div>
            </div>

            <div class="form-group">
                <label for="status">–°—Ç–∞—Ç—É—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è *</label>
                <select id="status" required>
                    <option value="">–û–±–µ—Ä—ñ—Ç—å —Å—Ç–∞—Ç—É—Å...</option>
                    <option value="completed">‚úÖ –í—Å—ñ –∑–∞–≤–¥–∞–Ω–Ω—è –≤–∏–∫–æ–Ω–∞–Ω–æ</option>
                    <option value="in_progress">üîÑ –í –ø—Ä–æ—Ü–µ—Å—ñ</option>
                    <option value="blocked">üö´ –Ñ –±–ª–æ–∫–µ—Ä–∏</option>
                </select>
                <div class="error" id="statusError">–û–±–µ—Ä—ñ—Ç—å —Å—Ç–∞—Ç—É—Å</div>
            </div>

            <div class="form-group">
                <label for="blockers">–ü—Ä–æ–±–ª–µ–º–∏/–ë–ª–æ–∫–µ—Ä–∏ (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ)</label>
                <textarea id="blockers" placeholder="–û–ø–∏—à—ñ—Ç—å –ø—Ä–æ–±–ª–µ–º–∏, —è–∫—â–æ —î..."></textarea>
            </div>

            <div class="form-group">
                <label for="plans">–ü–ª–∞–Ω–∏ –Ω–∞ –∑–∞–≤—Ç—Ä–∞ (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ)</label>
                <textarea id="plans" placeholder="–©–æ –ø–ª–∞–Ω—É—î—Ç–µ —Ä–æ–±–∏—Ç–∏ –∑–∞–≤—Ç—Ä–∞..."></textarea>
            </div>

            <div class="form-group">
                <label for="notes">–î–æ–¥–∞—Ç–∫–æ–≤—ñ –Ω–æ—Ç–∞—Ç–∫–∏ (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ)</label>
                <textarea id="notes" placeholder="–Ü–Ω—à—ñ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ..."></textarea>
            </div>
        </form>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø–æ—Ç–æ—á–Ω—É –¥–∞—Ç—É
        const dateOptions = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
        document.getElementById('currentDate').textContent = 
            new Date().toLocaleDateString('uk-UA', dateOptions);

        // –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è
        function addTask() {
            const taskList = document.getElementById('taskList');
            const taskItem = document.createElement('div');
            taskItem.className = 'task-item';
            taskItem.innerHTML = `
                <input type="text" placeholder="–û–ø–∏—à—ñ—Ç—å –∑–∞–≤–¥–∞–Ω–Ω—è..." required>
                <button type="button" class="btn-remove" onclick="removeTask(this)">‚úï</button>
            `;
            taskList.appendChild(taskItem);
        }

        // –í–∏–¥–∞–ª–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è
        function removeTask(button) {
            const taskList = document.getElementById('taskList');
            if (taskList.children.length > 1) {
                button.parentElement.remove();
            } else {
                alert('–ú–∞—î –±—É—Ç–∏ —Ö–æ—á–∞ –± –æ–¥–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è');
            }
        }

        // –í–∞–ª—ñ–¥–∞—Ü—ñ—è —Ñ–æ—Ä–º–∏
        function validateForm() {
            let isValid = true;

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–∞–≤–¥–∞–Ω—å
            const tasks = Array.from(document.querySelectorAll('.task-item input'))
                .map(input => input.value.trim())
                .filter(value => value !== '');
            
            if (tasks.length === 0) {
                document.getElementById('tasksError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('tasksError').style.display = 'none';
            }

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≥–æ–¥–∏–Ω
            const hours = document.getElementById('hours').value;
            if (!hours || hours <= 0) {
                document.getElementById('hoursError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('hoursError').style.display = 'none';
            }

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É
            const status = document.getElementById('status').value;
            if (!status) {
                document.getElementById('statusError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('statusError').style.display = 'none';
            }

            return isValid;
        }

        // –ó–±—ñ—Ä –¥–∞–Ω–∏—Ö —Ñ–æ—Ä–º–∏
        function collectFormData() {
            const tasks = Array.from(document.querySelectorAll('.task-item input'))
                .map(input => input.value.trim())
                .filter(value => value !== '');

            return {
                date: new Date().toISOString().split('T')[0],
                tasks: tasks,
                hours: parseFloat(document.getElementById('hours').value),
                status: document.getElementById('status').value,
                blockers: document.getElementById('blockers').value.trim(),
                plans: document.getElementById('plans').value.trim(),
                notes: document.getElementById('notes').value.trim(),
                timestamp: new Date().toISOString()
            };
        }

        // –ì–æ–ª–æ–≤–Ω–∞ –∫–Ω–æ–ø–∫–∞ Telegram
        tg.MainButton.setText('–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –∑–≤—ñ—Ç');
        tg.MainButton.show();
        tg.MainButton.onClick(() => {
            if (validateForm()) {
                const data = collectFormData();
                console.log('–í—ñ–¥–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–∏—Ö:', data);
                console.log('JSON –¥–∞–Ω—ñ:', JSON.stringify(data));
                
                try {
                    tg.sendData(JSON.stringify(data));
                    console.log('–î–∞–Ω—ñ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ');
                    tg.close();
                } catch (error) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–∏—Ö:', error);
                    alert('–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –∑–≤—ñ—Ç—É: ' + error.message);
                }
            } else {
                console.log('–§–æ—Ä–º–∞ –Ω–µ –≤–∞–ª—ñ–¥–Ω–∞');
            }
        });

        // –ê–Ω—ñ–º–∞—Ü—ñ—è –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ –≤–≤–µ–¥–µ–Ω–Ω—ñ
        document.getElementById('reportForm').addEventListener('input', () => {
            if (validateForm()) {
                tg.MainButton.color = '#34c759';
            } else {
                tg.MainButton.color = tg.themeParams.button_color || '#3390ec';
            }
        });
    </script>
</body>
</html>
